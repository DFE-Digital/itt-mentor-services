<% content_for :page_title, t(".heading") %>
<% render "claims/support/primary_navigation", current: :organisations %>

<div class="govuk-width-container">
  <h1 class="govuk-heading-l"><%= @school.name %></h1>
  <%= render "claims/support/schools/secondary_navigation", school: @school %>
  <h2 class="govuk-heading-m"><%= t(".heading") %></h2>

  <% if policy(Claims::Claim).create? %>
    <% if @school.mentors.any? %>
      <%= govuk_inset_text text: t(".guidance", start_year: Claims::ClaimWindow.current.academic_year.starts_on.year, end_year: Claims::ClaimWindow.current.academic_year.ends_on.year) %>

      <%= govuk_button_link_to t(".add_claim"), new_add_claim_claims_support_school_claims_path %>
    <% else %>
      <%= govuk_inset_text text: t(".add_mentor_guidance_html", link_to: govuk_link_to(t(".add_a_mentor"), claims_support_school_mentors_path(@school))) %>
    <% end %>
  <% else %>
    <%= govuk_inset_text do %>
      <p class="govuk-body"><%= t(".window_closed", start_year: Claims::ClaimWindow.previous.academic_year.starts_on.year, end_year: Claims::ClaimWindow.previous.academic_year.ends_on.year) %></p>
      <p class="govuk-body"><%= sanitize t(".window_closed_guidance", link_to: govuk_link_to(t(".window_closed_link_text"))) %></p>
    <% end %>
  <% end %>

  <% if @claims.any? %>
    <%= app_table do |table| %>
      <% table.with_head do |head| %>
        <% head.with_row do |row| %>
          <% row.with_cell(header: true, text: Claims::Claim.human_attribute_name(:reference)) %>
          <% row.with_cell(header: true, text: Claims::Claim.human_attribute_name(:accredited_provider)) %>
          <% row.with_cell(header: true, text: Claims::Claim.human_attribute_name(:mentors)) %>
          <% row.with_cell(header: true, text: Claims::Claim.human_attribute_name(:claim_amount)) %>
          <% row.with_cell(header: true, text: Claims::Claim.human_attribute_name(:submitted_at)) %>
          <% row.with_cell(header: true, text: Claims::Claim.human_attribute_name(:status)) %>
        <% end %>
      <% end %>

      <% table.with_body do |body| %>
        <% @claims.each do |claim| %>
          <% body.with_row do |row| %>
            <% row.with_cell(text: govuk_link_to(claim.reference, claims_support_school_claim_path(id: claim.id))) %>
            <% row.with_cell(text: claim.provider_name) %>
            <% row.with_cell do %>
              <ul class="govuk-list">
                <% claim.mentors.each do |mentor| %>
                  <li><%= mentor.full_name %></li>
                <% end %>
              </ul>
            <% end %>
            <% row.with_cell(text: humanized_money_with_symbol(claim.amount)) %>
            <% row.with_cell(text: safe_l(claim.submitted_on, format: :long)) %>
            <% row.with_cell(text: render(Claim::StatusTagComponent.new(claim:))) %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

    <%= render PaginationComponent.new(pagy: @pagy) %>
  <% else %>
    <p>
      <%= t("no_records_for", records: "claims", for: @school.name) %>
    </p>
  <% end %>
</div>
